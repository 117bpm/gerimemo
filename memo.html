<!DOCTYPE html>
<!--
„Åì„ÅÆ„Ç¢„Éó„É™„ÅØÈÄö‰ø°„ÇíË°å„ÅÑ„Åæ„Åõ„Çì„ÄÇ
„É°„É¢„ÅØ localStorage „Å´„ÅÆ„Åø‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ
Â§ñÈÉ®„Çπ„ÇØ„É™„Éó„Éà„ÉªÂ∫ÉÂëä„Éª„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
-->
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>„Åí„Çä„É°„É¢</title>
  <link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #f2f2f7;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      overflow: hidden;
    }

    /* „Ç¢„Éó„É™ÂÖ®‰Ωì */
    .app {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 16px;
      box-sizing: border-box;
      background: white;
      width: 100%;
      max-width: 500px; /* PC„Åß‰∏≠Â§Æ„Å´Âõ∫ÂÆöÂπÖ */
      margin: 0 auto;   /* PC„Åß‰∏≠Â§ÆÂØÑ„Åõ */
      border-radius: 0;
    }

    h1 {
      text-align: center;
      font-size: 1.8em;
      margin: 8px 0 16px 0;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 20px;
      color: white;
      cursor: pointer;
      margin-right: 8px;
    }

    #save { background: #007aff; }
    .delete { background: #ff3b30; }

    #sort {
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 16px;
      color: white;
      background: #007aff;
      cursor: pointer;
      margin-bottom: 12px;
      width: auto;
      height: auto;
    }

    #list {
      flex: 1;
      overflow-y: auto;
      margin-top: 8px;
    }

    .memo-item {
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 12px;
      background: #f9f9f9;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: relative;
    }

    .memo-title { font-weight: bold; margin-bottom: 4px; }
    .memo-date { font-size: 12px; color: #666; margin-bottom: 8px; }

    @media (prefers-color-scheme: dark) {
      body { background:#1c1c1e; }
      .app { background:#2c2c2e; color:white; }
      input,textarea { background:#3a3a3c; color:white; border:none; }
      .memo-item { background:#3a3a3c; color:white; }
      .memo-date { color:#aaa; }
    }

    /* „Çπ„Éû„Éõ„Åß„ÅØÂÖ®ÁîªÈù¢ÂπÖ */
    @media (max-width: 600px) {
      .app {
        max-width: 100%;
        margin: 0;
        border-radius: 0;
      }
    }
    #updateNotice {
  position: fixed;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  background: #007aff;
  color: white;
  padding: 10px 16px;
  border-radius: 12px;
  font-size: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  z-index: 9999;
  display: none;
}

  </style>
</head>
<body>
  <div id="updateNotice">„Ç¢„Éó„É™„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü</div>
  <div class="app">
    <h1>„Åí„Çä„É°„É¢</h1>
    <input id="title" placeholder="„Çø„Ç§„Éà„É´">
    <textarea id="memo" placeholder="„É°„É¢ÂÜÖÂÆπ"></textarea>
    <input id="search" placeholder="Ê§úÁ¥¢...">
    <button id="sort">Êñ∞„Åó„ÅÑÈ†Ü</button>
    <button id="save">+</button>
    <div id="list"></div>
  </div>

  <script>
    let editingIndex = null; // ‚Üê ËøΩÂä†Ôºà‰ªäÁ∑®ÈõÜ‰∏≠„ÅÆ„É°„É¢Ôºâ
    // È´ò„Åï„ÇíÁîªÈù¢„Å´Âêà„Çè„Åõ„Å¶Âõ∫ÂÆö
    function setAppHeight() {
      const app = document.querySelector('.app');
      app.style.height = window.innerHeight + 'px';
    }
    window.addEventListener('load', setAppHeight);
    window.addEventListener('resize', setAppHeight);

    const titleInput = document.getElementById('title');
    const memoInput = document.getElementById('memo');
    const saveButton = document.getElementById('save');
    const listDiv = document.getElementById('list');
    const searchInput = document.getElementById('search');
    const sortButton = document.getElementById('sort');

    let memos = JSON.parse(localStorage.getItem('memos') || '[]');
    let sortNewest = true;

    function renderMemos() {
  listDiv.innerHTML = '';

  const sorted = [...memos].sort((a, b) =>
    sortNewest
      ? new Date(b.date) - new Date(a.date)
      : new Date(a.date) - new Date(b.date)
  );

  const filter = searchInput.value.toLowerCase();
  const filtered = sorted.filter(m =>
    (m.title + m.content).toLowerCase().includes(filter)
  );

  filtered.forEach(m => {
    const index = memos.findIndex(x =>
      x.date === m.date && x.title === m.title
    );

    const div = document.createElement('div');
    div.className = 'memo-item';
    div.innerHTML = `
      <div class="memo-title">${m.title || '(ÁÑ°È°å)'}</div>
      <div class="memo-date">${m.date}</div>
      <div>${m.content}</div>
      <button class="edit">‚úèÔ∏è</button>
      <button class="delete">üóëÔ∏è</button>
    `;

    // ÂâäÈô§
    div.querySelector('.delete').onclick = () => {
      memos.splice(index, 1);
      localStorage.setItem('memos', JSON.stringify(memos));
      renderMemos();
    };

    // ‚òÖ Á∑®ÈõÜ„É¢„Éº„Éâ„Å´ÂÖ•„Çã
    div.querySelector('.edit').onclick = () => {
      titleInput.value = m.title;
      memoInput.value = m.content;
      editingIndex = index;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    listDiv.appendChild(div);
  });
}

/* ‚Üê‚Üê‚Üê„Äê„Åì„Åì„ÄërenderMemos „ÅåÁµÇ„Çè„Å£„ÅüÁõ¥Âæå„Äë‚Üê‚Üê‚Üê */

function showUpdateNotice() {
  const notice = document.getElementById('updateNotice');
  notice.style.display = 'block';
  setTimeout(() => {
    notice.style.display = 'none';
  }, 5000);
}

/* ‚Üê‚Üê‚Üê„Äê„Åì„Åì„Åæ„Åß„Äë‚Üê‚Üê‚Üê */

saveButton.onclick = () => {
  if (!titleInput.value.trim() && !memoInput.value.trim()) return;

  const now = new Date();

  if (editingIndex !== null) {
    // Á∑®ÈõÜ„É¢„Éº„ÉâÔºö‰∏äÊõ∏„Åç‰øùÂ≠ò
    memos[editingIndex].title = titleInput.value;
    memos[editingIndex].content = memoInput.value;
    memos[editingIndex].date = now.toLocaleString();
    editingIndex = null;
  } else {
    // Êñ∞Ë¶è‰ΩúÊàê
    memos.push({
      title: titleInput.value,
      content: memoInput.value,
      date: now.toLocaleString()
    });
  }

  localStorage.setItem('memos', JSON.stringify(memos));
  titleInput.value = '';
  memoInput.value = '';
  renderMemos();
};


    searchInput.oninput = renderMemos;
    sortButton.onclick = ()=>{
      sortNewest=!sortNewest;
      sortButton.textContent = sortNewest?'Êñ∞„Åó„ÅÑÈ†Ü':'Âè§„ÅÑÈ†Ü';
      renderMemos();
    };

    renderMemos();
  </script>

 <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');

navigator.serviceWorker.addEventListener('controllerchange', () => {
  showUpdateNotice();
});

  }
</script>

</body>
</html>
