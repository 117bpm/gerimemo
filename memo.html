<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã’ã‚Šãƒ¡ãƒ¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f6efe9;
}
.app {
  max-width: 520px;
  margin: 0 auto;
  padding: 16px;
  background: #fffaf6;
  min-height: 100vh;
}
h1 {
  text-align: center;
  color: #b33a2b;
}
input, textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 14px;
  border: 1px solid #e0cfc2;
  font-size: 16px;
  background: #fffdfb;
}
textarea {
  resize: none;
  height: 5.5em;
}
#drawToggle {
  width: 100%;
  padding: 12px;
  border-radius: 14px;
  border: none;
  background: #d96c5c;
  color: white;
  font-size: 16px;
}
#drawCanvas {
  display: none;
  width: 100%;
  height: 330px;
  margin-top: 8px;
  border-radius: 16px;
  background: white;
  border: 1px solid #e0cfc2;
  touch-action: none;
}
#canvasButtons {
  display: none;
  gap: 8px;
  margin-top: 8px;
}
#canvasButtons button {
  flex: 1;
  padding: 10px;
  border-radius: 14px;
  border: none;
  color: white;
}
#saveCanvas { background: #b33a2b; }
#clearCanvas { background: #999; }

.memo {
  padding: 14px;
  border-radius: 18px;
  margin-bottom: 14px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  color: #333;
}
.c0 { background:#fde2e2 }
.c1 { background:#f9e4c8 }
.c2 { background:#fcebd5 }
.c3 { background:#f6d6cc }
.c4 { background:#f3e7dc }

.memo-title { font-weight:bold }
.memo-date { font-size:12px; opacity:.6; margin-bottom:6px }
.memo-text { white-space:pre-wrap; margin-bottom:8px }

.memo-buttons {
  display:flex;
  gap:8px;
}
.memo-buttons button {
  flex:1;
  padding:8px;
  border-radius:12px;
  border:none;
  background:rgba(0,0,0,.15);
}
</style>
</head>

<body>
<div class="app">
<h1>ğŸ¾ ã’ã‚Šãƒ¡ãƒ¢</h1>

<input id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
<textarea id="memo" placeholder="ãƒ¡ãƒ¢å†…å®¹"></textarea>

<button id="drawToggle">âœï¸ æ‰‹æ›¸ãã™ã‚‹</button>
<canvas id="drawCanvas" width="400" height="330"></canvas>
<div id="canvasButtons">
  <button id="saveCanvas">ä¿å­˜</button>
  <button id="clearCanvas">ã‚¯ãƒªã‚¢</button>
</div>

<div id="list"></div>
</div>

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆäº’æ›å¯¾å¿œï¼‰ ===== */
let raw = JSON.parse(localStorage.getItem('memos') || '[]');
let memos = raw.map(m => ({
  title: m.title ?? '',
  text: m.text ?? m.memo ?? '',
  img: m.img ?? m.drawing ?? m.image ?? null,
  date: m.date ?? ''
}));

let editIndex = null;

const titleEl = document.getElementById('title');
const memoEl = document.getElementById('memo');
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');

const drawToggle = document.getElementById('drawToggle');
const canvasButtons = document.getElementById('canvasButtons');

let drawMode = false;
let drawing = false;
let lx = 0, ly = 0;

/* ===== æç”» ===== */
drawToggle.onclick = () => {
  drawMode = !drawMode;
  canvas.style.display = drawMode ? 'block' : 'none';
  canvasButtons.style.display = drawMode ? 'flex' : 'none';
};

function pos(e){
  const r = canvas.getBoundingClientRect();
  const p = e.touches ? e.touches[0] : e;
  return {
    x:(p.clientX-r.left)*canvas.width/r.width,
    y:(p.clientY-r.top)*canvas.height/r.height
  };
}
canvas.onmousedown = e=>{ if(drawMode){drawing=true;({x:lx,y:ly}=pos(e));}};
canvas.onmousemove = e=>{
  if(!drawing) return;
  const p=pos(e);
  ctx.beginPath();
  ctx.moveTo(lx,ly);
  ctx.lineTo(p.x,p.y);
  ctx.lineWidth=2;
  ctx.lineCap='round';
  ctx.stroke();
  lx=p.x; ly=p.y;
};
canvas.onmouseup=()=>drawing=false;
canvas.ontouchstart=e=>{ if(drawMode){drawing=true;({x:lx,y:ly}=pos(e));}};
canvas.ontouchmove=canvas.onmousemove;
canvas.ontouchend=()=>drawing=false;

clearCanvas.onclick=()=>ctx.clearRect(0,0,canvas.width,canvas.height);

/* ===== ä¿å­˜ ===== */
saveCanvas.onclick=()=>{
  const hasImg = ctx.getImageData(0,0,canvas.width,canvas.height).data.some(v=>v!==0);
  const img = hasImg ? canvas.toDataURL() : null;

  const data = {
    title: titleEl.value,
    text: memoEl.value,
    img,
    date: new Date().toLocaleString()
  };

  if(editIndex!==null){
    memos[editIndex]=data;
    editIndex=null;
  } else {
    memos.push(data);
  }

  localStorage.setItem('memos',JSON.stringify(memos));
  titleEl.value='';
  memoEl.value='';
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMode=false;
  canvas.style.display='none';
  canvasButtons.style.display='none';
  render();
};

/* ===== è¡¨ç¤º ===== */
function render(){
  list.innerHTML='';
  memos.slice().reverse().forEach((m,i)=>{
    const idx=memos.length-1-i;
    const d=document.createElement('div');
    d.className='memo c'+(i%5);
    d.innerHTML=`
      <div class="memo-title">ğŸ¾ ${m.title||'(ç„¡é¡Œ)'}</div>
      <div class="memo-date">${m.date}</div>
      <div class="memo-text">${m.text}</div>
      ${m.img?`<img src="${m.img}" style="max-width:100%;border-radius:14px;">`:''}
      <div class="memo-buttons">
        <button>âœï¸ ç·¨é›†</button>
        <button>ğŸ—‘ï¸ å‰Šé™¤</button>
      </div>
    `;
    d.querySelectorAll('button')[0].onclick=()=>{
      titleEl.value=memos[idx].title;
      memoEl.value=memos[idx].text;
      if(memos[idx].img){
        const img=new Image();
        img.onload=()=>ctx.drawImage(img,0,0);
        img.src=memos[idx].img;
        drawMode=true;
        canvas.style.display='block';
        canvasButtons.style.display='flex';
      }
      editIndex=idx;
      window.scrollTo({top:0,behavior:'smooth'});
    };
    d.querySelectorAll('button')[1].onclick=()=>{
      memos.splice(idx,1);
      localStorage.setItem('memos',JSON.stringify(memos));
      render();
    };
    list.appendChild(d);
  });
}
render();
</script>
</body>
</html>
