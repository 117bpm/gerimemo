<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã’ã‚Šãƒ¡ãƒ¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<style>
html, body {
  margin: 0;
  padding: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f6efe9;
}

/* å…¨ä½“ */
.app {
  max-width: 520px;
  margin: 0 auto;
  padding: 16px;
  min-height: 100vh;
  box-sizing: border-box;
  background: #fffaf6;
}

/* ã‚¿ã‚¤ãƒˆãƒ« */
h1 {
  text-align: center;
  color: #b33a2b;
  margin-bottom: 16px;
}

/* å…¥åŠ›æ¬„ */
input, textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 14px;
  border: 1px solid #e0cfc2;
  font-size: 16px;
  background: #fffdfb;
}

textarea {
  height: 4.5em;
  resize: none;
}

/* æç”»ã‚¨ãƒªã‚¢ */
#canvasArea {
  margin-bottom: 16px;
}

#drawToggle {
  width: 100%;
  padding: 12px;
  border-radius: 14px;
  border: none;
  background: #d96c5c;
  color: white;
  font-size: 16px;
}

#drawCanvas {
  display: none;
  width: 100%;
  height: 340px;
  margin-top: 8px;
  border-radius: 16px;
  background: white;
  border: 1px solid #e0cfc2;
  touch-action: none;
}

#canvasButtons {
  display: none;
  margin-top: 8px;
  gap: 8px;
}

#canvasButtons button {
  flex: 1;
  padding: 10px;
  border-radius: 14px;
  border: none;
  font-size: 15px;
  color: white;
}

#saveCanvas { background: #b33a2b; }
#clearCanvas { background: #999; }

/* ãƒ¡ãƒ¢ä¸€è¦§ */
#list {
  margin-top: 8px;
}

/* ãƒ¡ãƒ¢ã‚«ãƒ¼ãƒ‰ */
.memo {
  padding: 14px;
  border-radius: 18px;
  margin-bottom: 14px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  color: #333;
}

.memo-title {
  font-weight: bold;
  margin-bottom: 4px;
}

.memo-date {
  font-size: 12px;
  opacity: 0.7;
  margin-bottom: 6px;
}

.memo-text {
  white-space: pre-wrap;
  line-height: 1.5;
  margin-bottom: 8px;
}

/* çŒ«ã‚«ãƒ©ãƒ¼ */
.c0 { background: #fde2e2; }
.c1 { background: #f9e4c8; }
.c2 { background: #fcebd5; }
.c3 { background: #f6d6cc; }
.c4 { background: #f3e7dc; }

/* ãƒ¡ãƒ¢å†…ãƒœã‚¿ãƒ³ */
.memo-buttons {
  display: flex;
  gap: 8px;
}

.memo-buttons button {
  flex: 1;
  padding: 8px;
  border-radius: 12px;
  border: none;
  background: rgba(0,0,0,0.15);
  font-size: 14px;
}

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
@media (prefers-color-scheme: dark) {
  body { background: #2b2523; }
  .app { background: #2f2a27; color: #eee; }
  input, textarea { background: #3a3330; color: #eee; border: none; }

  .memo {
    color: #222; /* â† æ˜ã‚‹ã„ã‚«ãƒ¼ãƒ‰ã§ã‚‚æ–‡å­—ãŒå¿…ãšè¦‹ãˆã‚‹ */
  }
}
</style>
</head>

<body>
<div class="app">

<h1>ğŸ¾ ã’ã‚Šãƒ¡ãƒ¢</h1>

<input id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
<textarea id="memo" placeholder="ãƒ¡ãƒ¢å†…å®¹"></textarea>

<div id="canvasArea">
  <button id="drawToggle">âœï¸ æ‰‹æ›¸ãã™ã‚‹</button>
  <canvas id="drawCanvas" width="400" height="340"></canvas>
  <div id="canvasButtons">
    <button id="saveCanvas">ä¿å­˜</button>
    <button id="clearCanvas">ã‚¯ãƒªã‚¢</button>
  </div>
</div>

<div id="list"></div>

</div>

<script>
let memos = JSON.parse(localStorage.getItem('memos') || '[]');
let editIndex = null;

const titleEl = document.getElementById('title');
const memoEl = document.getElementById('memo');
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');

const drawToggle = document.getElementById('drawToggle');
const canvasButtons = document.getElementById('canvasButtons');

let drawMode = false;
let drawing = false;
let lx = 0, ly = 0;

/* æç”»ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
drawToggle.onclick = () => {
  drawMode = !drawMode;
  canvas.style.display = drawMode ? 'block' : 'none';
  canvasButtons.style.display = drawMode ? 'flex' : 'none';
  drawToggle.textContent = drawMode ? 'ğŸ± æç”»ä¸­' : 'âœï¸ æ‰‹æ›¸ãã™ã‚‹';
};

/* æç”»å‡¦ç† */
function pos(e) {
  const r = canvas.getBoundingClientRect();
  const p = e.touches ? e.touches[0] : e;
  return {
    x: (p.clientX - r.left) * canvas.width / r.width,
    y: (p.clientY - r.top) * canvas.height / r.height
  };
}

canvas.onmousedown = e => { if(drawMode){drawing=true; ({x:lx,y:ly}=pos(e));}};
canvas.onmousemove = e => {
  if(!drawing) return;
  e.preventDefault();
  const p = pos(e);
  ctx.beginPath();
  ctx.moveTo(lx,ly);
  ctx.lineTo(p.x,p.y);
  ctx.lineWidth = 2;
  ctx.lineCap = 'round';
  ctx.strokeStyle = '#333';
  ctx.stroke();
  lx=p.x; ly=p.y;
};
canvas.onmouseup = ()=>drawing=false;

canvas.ontouchstart = e => { if(drawMode){drawing=true; ({x:lx,y:ly}=pos(e));}};
canvas.ontouchmove = canvas.onmousemove;
canvas.ontouchend = ()=>drawing=false;

clearCanvas.onclick = () => ctx.clearRect(0,0,canvas.width,canvas.height);

/* ä¿å­˜ */
saveCanvas.onclick = () => {
  if(!titleEl.value && !memoEl.value) return;

  const hasImg = ctx.getImageData(0,0,canvas.width,canvas.height).data.some(v=>v!==0);
  const img = hasImg ? canvas.toDataURL() : null;
  const now = new Date().toLocaleString();

  const data = {title:titleEl.value, text:memoEl.value, img, date:now};

  if(editIndex !== null){
    memos[editIndex] = {...memos[editIndex], ...data};
    editIndex = null;
  } else {
    memos.push(data);
  }

  localStorage.setItem('memos', JSON.stringify(memos));
  titleEl.value = memoEl.value = '';
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMode=false;
  canvas.style.display='none';
  canvasButtons.style.display='none';
  drawToggle.textContent='âœï¸ æ‰‹æ›¸ãã™ã‚‹';
  render();
};

/* è¡¨ç¤º */
function render(){
  list.innerHTML='';
  memos.slice().reverse().forEach((m,i)=>{
    const d=document.createElement('div');
    d.className='memo c'+(i%5);
    d.innerHTML=`
      <div class="memo-title">ğŸ¾ ${m.title||'(ç„¡é¡Œ)'}</div>
      <div class="memo-date">${m.date}</div>
      <div class="memo-text">${m.text||''}</div>
      ${m.img?`<img src="${m.img}" style="max-width:100%;border-radius:14px;">`:''}
      <div class="memo-buttons">
        <button>âœï¸ ç·¨é›†</button>
        <button>ğŸ—‘ï¸ å‰Šé™¤</button>
      </div>
    `;
    d.querySelectorAll('button')[0].onclick=()=>{
      const idx=memos.length-1-i;
      titleEl.value=memos[idx].title;
      memoEl.value=memos[idx].text;
      editIndex=idx;
      window.scrollTo({top:0,behavior:'smooth'});
    };
    d.querySelectorAll('button')[1].onclick=()=>{
      memos.splice(memos.length-1-i,1);
      localStorage.setItem('memos',JSON.stringify(memos));
      render();
    };
    list.appendChild(d);
  });
}

render();
</script>
</body>
</html>
