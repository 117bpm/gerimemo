<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã’ã‚Šãƒ¡ãƒ¢</title>
<link rel="manifest" href="manifest.json?v=6">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<style>
html, body {margin:0; padding:0; height:100%; font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif; background:#f2f2f7;}
.app {display:flex; flex-direction:column; padding:16px; box-sizing:border-box; background:white; width:100%; max-width:500px; margin:0 auto;}
h1 {text-align:center; font-size:1.8em; margin:8px 0 16px 0;}
input, textarea {width:100%; padding:12px; margin-bottom:12px; border:1px solid #ccc; border-radius:8px; font-size:16px; box-sizing:border-box;}
textarea {
  min-height:120px;
  overflow-y:auto;
  resize: vertical; /* ç¸¦æ–¹å‘ã«ãƒªã‚µã‚¤ã‚ºå¯èƒ½ */
}
@media (max-width:600px) {
  textarea {
    min-height:150px; /* ã‚¹ãƒãƒ›ã§å°‘ã—é«˜ã‚ */
    resize: vertical; /* ãƒãƒ³ãƒ‰ãƒ«è¡¨ç¤º */
  }
}
button {border:none; border-radius:50%; width:48px; height:48px; font-size:20px; color:white; cursor:pointer; margin-right:8px;}
#save {background:#007aff;}
.delete {background:#ff3b30;}
#sort {border-radius:8px; padding:8px 14px; font-size:16px; color:white; background:#007aff; cursor:pointer; margin-bottom:12px; width:auto; height:auto;}
#list {flex:1; overflow-y:auto; margin-top:8px;}
.memo-item {padding:12px; margin-bottom:12px; border-radius:12px; background:#f9f9f9; box-shadow:0 2px 6px rgba(0,0,0,0.1); position:relative;}
.memo-title {font-weight:bold; margin-bottom:4px;}
.memo-date {font-size:12px; color:#666; margin-bottom:8px;}
#updateNotice {position:fixed; top:12px; left:50%; transform:translateX(-50%); background:#007aff; color:white; padding:10px 16px; border-radius:12px; font-size:14px; box-shadow:0 4px 10px rgba(0,0,0,0.2); z-index:9999; display:none;}
#canvasContainer {margin-bottom:12px; width:100%;}
#canvasContainer canvas {width:100%; max-width:100%; border:1px solid #ccc; touch-action:none; box-sizing:border-box;}
@media (min-width:601px) {
  #canvasContainer canvas { max-width: calc(100% - 5px); } /* PCç‰ˆã‚’5pxç‹­ã */
}
#clearCanvas {width:auto; height:auto; border-radius:8px; margin-top:4px; display:block;}
</style>
</head>
<body>
<div id="updateNotice">ã‚¢ãƒ—ãƒªãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ</div>
<div class="app">
<h1>ã’ã‚Šãƒ¡ãƒ¢</h1>
<input id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
<textarea id="memo" placeholder="ãƒ¡ãƒ¢å†…å®¹"></textarea>

<!-- æ‰‹æ›¸ãã‚­ãƒ£ãƒ³ãƒã‚¹ -->
<div id="canvasContainer">
  <canvas id="drawCanvas" width="400" height="400"></canvas>
  <button id="clearCanvas">ã‚¯ãƒªã‚¢</button>
</div>

<button id="sort">æ–°ã—ã„é †</button>
<button id="save">+</button>
<div id="list"></div>
</div>

<script>
let memos = JSON.parse(localStorage.getItem('memos') || '[]');
let sortNewest = true;
let editingIndex = null;

const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');

function renderMemos() {
  const listDiv = document.getElementById('list');
  listDiv.innerHTML = '';
  const sorted = [...memos].sort((a,b)=> sortNewest? new Date(b.date)-new Date(a.date) : new Date(a.date)-new Date(b.date));
  sorted.forEach(m=>{
    const index = memos.findIndex(x=>x.date===m.date && x.title===m.title);
    const div = document.createElement('div');
    div.className='memo-item';
    div.innerHTML=`
      <div class="memo-title">${m.title||'(ç„¡é¡Œ)'}</div>
      <div class="memo-date">${m.date}</div>
      <div>${m.content}</div>
      ${m.image? `<img src="${m.image}" style="max-width:100%; border-radius:12px; margin-top:8px;">` : ''}
      <button class="edit">âœï¸</button>
      <button class="delete">ğŸ—‘ï¸</button>
    `;
    div.querySelector('.delete').onclick = ()=>{
      memos.splice(index,1);
      localStorage.setItem('memos',JSON.stringify(memos));
      renderMemos();
    };
    div.querySelector('.edit').onclick = ()=>{
      document.getElementById('title').value = m.title;
      document.getElementById('memo').value = m.content;
      editingIndex = index;
      if(m.image){
        const img = new Image();
        img.onload = ()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.drawImage(img,0,0,canvas.width,canvas.height); };
        img.src = m.image;
      } else { ctx.clearRect(0,0,canvas.width,canvas.height); }
      window.scrollTo({top:0,behavior:'smooth'});
    };
    listDiv.appendChild(div);
  });
}
renderMemos();

const titleInput = document.getElementById('title');
const memoInput = document.getElementById('memo');
const saveButton = document.getElementById('save');
const sortButton = document.getElementById('sort');

saveButton.onclick = ()=>{
  const textEmpty = !titleInput.value.trim() && !memoInput.value.trim();
  const canvasEmpty = ctx.getImageData(0,0,canvas.width,canvas.height).data.every(v=>v===0);
  if(textEmpty && canvasEmpty) return;
  const now = new Date();
  const imageData = canvasEmpty? null : canvas.toDataURL();
  if(editingIndex!==null){
    memos[editingIndex].title = titleInput.value;
    memos[editingIndex].content = memoInput.value;
    memos[editingIndex].image = imageData || memos[editingIndex].image;
    memos[editingIndex].date = now.toLocaleString();
    editingIndex = null;
  } else {
    memos.push({title:titleInput.value, content:memoInput.value, image:imageData, date:now.toLocaleString()});
  }
  localStorage.setItem('memos',JSON.stringify(memos));
  titleInput.value=''; memoInput.value=''; ctx.clearRect(0,0,canvas.width,canvas.height);
  renderMemos();
};

sortButton.onclick = ()=>{
  sortNewest=!sortNewest;
  sortButton.textContent = sortNewest?'æ–°ã—ã„é †':'å¤ã„é †';
  renderMemos();
};

// æç”»å‡¦ç†
let drawing=false,lastX=0,lastY=0;
function getPointerPos(e){
  const rect=canvas.getBoundingClientRect();
  const scaleX=canvas.width/rect.width;
  const scaleY=canvas.height/rect.height;
  const clientX = e.touches? e.touches[0].clientX : e.clientX;
  const clientY = e.touches? e.touches[0].clientY : e.clientY;
  return {x:(clientX-rect.left)*scaleX, y:(clientY-rect.top)*scaleY};
}
function startDraw(e){ drawing=true; const pos=getPointerPos(e); lastX=pos.x; lastY=pos.y; }
function draw(e){ if(!drawing) return; e.preventDefault(); const pos=getPointerPos(e); ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(pos.x,pos.y); ctx.strokeStyle='#000'; ctx.lineWidth=2; ctx.lineCap='round'; ctx.stroke(); lastX=pos.x; lastY=pos.y; }
function stopDraw(){ drawing=false; }

canvas.addEventListener('mousedown',startDraw);
canvas.addEventListener('mousemove',draw);
canvas.addEventListener('mouseup',stopDraw);
canvas.addEventListener('mouseout',stopDraw);
canvas.addEventListener('touchstart',startDraw);
canvas.addEventListener('touchmove',draw);
canvas.addEventListener('touchend',stopDraw);

document.getElementById('clearCanvas').onclick = ()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); };
</script>
</body>
</html>
